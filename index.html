<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>動画再生アプリ</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    video {
      max-width: 100%;
      margin-bottom: 10px;
    }
    .controls {
      margin-top: 10px;
    }
    label, input {
      margin-right: 10px;
    }
  </style>
</head>
<body>

  <h1>動画再生アプリ</h1>

  <input type="file" id="videoUpload" accept="video/*">
  <br><br>

  <video id="video" controls></video>

  <div class="controls">
    <label for="speed">再生速度：</label>
    <input type="number" id="speed" value="1.0" step="0.1" min="0.1" max="5.0">
    <button onclick="setPlaybackSpeed()">変更</button>
  </div>

  <div class="controls">
    <label for="pointA">A点（秒）：</label>
    <input type="number" id="pointA" step="0.1" min="0">
    <label for="pointB">B点（秒）：</label>
    <input type="number" id="pointB" step="0.1" min="0">
    <button onclick="setABRepeat()">A-Bリピート開始</button>
    <button onclick="clearABRepeat()">停止</button>
  </div>

  <script>
    const video = document.getElementById('video');
    const videoUpload = document.getElementById('videoUpload');
    const speedInput = document.getElementById('speed');
    const pointAInput = document.getElementById('pointA');
    const pointBInput = document.getElementById('pointB');

    let abRepeatInterval = null;
    let pointA = null;
    let pointB = null;

    videoUpload.addEventListener('change', function () {
      const file = this.files[0];
      if (file) {
        const url = URL.createObjectURL(file);
        video.src = url;
        video.load();
        clearABRepeat();
      }
    });

    function setPlaybackSpeed() {
      const speed = parseFloat(speedInput.value);
      if (speed >= 0.1 && speed <= 5.0) {
        video.playbackRate = speed;
      } else {
        alert("速度は0.1〜5.0の範囲で設定してください。");
      }
    }

    function setABRepeat() {
      pointA = parseFloat(pointAInput.value);
      pointB = parseFloat(pointBInput.value);

      if (isNaN(pointA) || isNaN(pointB) || pointA >= pointB) {
        alert("有効なA-B間を設定してください。");
        return;
      }

      clearABRepeat(); // 重複防止
      video.currentTime = pointA;
      video.play();

      abRepeatInterval = setInterval(() => {
        if (video.currentTime >= pointB) {
          video.currentTime = pointA;
        }
      }, 200);
    }

    function clearABRepeat() {
      if (abRepeatInterval) {
        clearInterval(abRepeatInterval);
        abRepeatInterval = null;
      }
    }
  </script>

</body>
</html>
